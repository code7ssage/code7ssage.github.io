---
title: 3 2. Data Readiness Check & Sampling
categories:
  - machine_learning
toc: true
---

# **ğŸš© Chapter 02**  

---
> **ëª©ì°¨(Context)**

* 01.Data Info check
* 02.Data Readiness Check
* 03.Data Sampling (1)
* 04.Data Sampling (2)
## **01. Data Info check**
---
> **ìˆ˜ì§‘ëœ ë°ì´í„°ì˜ ê¸°ë³¸ ì •ë³´ë“¤ì„ í™•ì¸** 

* Dataë¥¼ Readí•˜ê³  ë°ì´í„°ì˜ í˜•íƒœ, íƒ€ì…, ê¸°ê°„ ë“± ì „ë°˜ì ì¸ ê¸°ë³¸ ì •ë³´ë¥¼ íŒŒì•…í•˜ëŠ” ë‹¨ê³„  
* ê¸°ë³¸ ì‚¬í•­ì„ í™•ì¸í•˜ë©° ì „ì²˜ë¦¬ë„ ê°™ì´ ìˆ˜í–‰í•¨
	  (1) Data shape(í˜•íƒœ) í™•ì¸ 
	  (2) Data type í™•ì¸
	  (3) Nullê°’ í™•ì¸ (â€» ë¹ˆ ê°’ì˜ Data)
	  (4) ì¤‘ë³µ ë°ì´í„° í™•ì¸
	  (5) Outlier í™•ì¸ (â€» ì •ìƒì ì¸ ë²”ì£¼ë¥¼ ë²—ì–´ë‚œ Data)  

> **ë°ì´í„° ì‚´í´ë³´ê¸°**

* ì´ì»¤ë¨¸ìŠ¤ ì˜¨ë¼ì¸ êµ¬ë§¤ ë°ì´í„°
* ë°ì´í„° ëª…ì„¸ â¬‡

|InvoiceNo|StockCode|Description|Quantity|InvoiceDate|UnitPrice|CustomerID|Country| 
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|ì†¡ì¥ë²ˆí˜¸|ì¬ê³ ì½”ë“œ|ìƒì„¸ì„¤ëª…|ìˆ˜ëŸ‰|ì†¡ì¥ë‚ ì§œ|ê°œë‹¹ê°€ê²©|ê³ ê°ID|êµ­ê°€|

```python
# â–¶ Warnings ì œê±°
import warnings
warnings.filterwarnings('ignore')

# â–¶ Google drive mount or í´ë” í´ë¦­ í›„ êµ¬ê¸€ë“œë¼ì´ë¸Œ ì—°ê²°
from google.colab import drive
drive.mount('/content/drive') 

# â–¶ ê²½ë¡œ ì„¤ì • (â€» Colabì„ í™œì„±í™”ì‹œì¼°ë‹¤ë©´ ë³´í†µ Colab Notebooks í´ë”ê°€ ìë™ ìƒì„±)
import os
os.chdir('/content/drive/MyDrive/Colab Notebooks/00.Fast_campus/04.ML_signature/Part3')

# â–¶ ë³€ê²½ëœ ê²½ë¡œ í™•ì¸
os.getcwd()
```
- ê²½ë¡œ ì„¤ì •ì€ ìê¸° driveì˜ íŒŒì¼ë¡œ

```python
# â–¶ pd.set option
import numpy as np
import pandas as pd 
pd.set_option('display.max_columns',100)
pd.set_option('display.max_rows',100)  

# â–¶ Data read (encoding ì •ë³´ í™•ì¸ í•„ìˆ˜)
df = pd.read_csv('Part3_Data.csv', encoding='ISO-8859-1')
# df = pd.read_csv('Part3_Data.csv')
df.head()
```
- ì „ë‹¬ ë°›ì€ encodingì •ë³´ ê¸°ì…í•˜ëŠ” ê±° í•„ìˆ˜  

```python
# â–¶ Data í˜•íƒœ í™•ì¸
# â–¶ 541,909 row, 8 colë¡œ êµ¬ì„±ë¨
df.shape
```
- 54ë§Œê°œì˜ row, 8ê°œì˜ col

```python
# â–¶ Data type í™•ì¸
df.info()
```
- invoiceDateëŠ” ë¬¸ìì—´ì—ì„œ ì‹œê°„ í˜•íƒœë¡œ ë°”ê¿”ì•¼ í•  ë“¯
- custom IDë„ ë¬¸ìì—´ë¡œ ë°”ê¾¸ëŠ”ê²Œ ë‚˜ì„ ë“¯

```python
# â–¶ Null ê°’ í™•ì¸
print(df.isnull().sum())
```

```python
# â–¶ Null value drop í•„ìš”
# â–¶ CustomerID ê¸°ì¤€ìœ¼ë¡œ Null value drop
df.dropna(subset=['CustomerID'], how='all', inplace=True)
df.isnull().sum()
```
- custom IDì—´ì˜ nullê°’ ì „ë¶€ drop, inplace-> ë°”ë¡œ ì ìš©
- ê·¼ë° descriptionì— ìˆë˜ nullê°’ë„ ì‚¬ë¼ì§-> ì•„ë§ˆ custom IDì— í¬í•¨ ë˜ì–´ìˆì—ˆëŠ” ë“¯ 

```python
# â–¶ Outlier í™•ì¸ (â€»Domain ì§€ì‹ ì—†ì´ ì„±ê¸‰í•˜ê²Œ Outlierë¥¼ ì œê±°í•˜ëŠ” í–‰ìœ„ëŠ” ìœ„í—˜í•¨)
# â–¶ QuantityëŠ” ìŒìˆ˜ ê°’ì´ ì¡´ì¬í•  ìˆ˜ ì—†ìŒ
df.describe()
```
- quantityì— ìŒìˆ˜ ê°’ì´ ìˆëŠ”ê²Œ ë§ì´ ì•ˆë¨;;

```python
# â–¶ distplot í™œìš© ìŒìˆ˜ ë°ì´í„° ë¶„í¬ í™•ì¸
import seaborn as sns
import matplotlib.pyplot as plt
%matplotlib inline
plt.style.use(['dark_background'])

sns.distplot(df['Quantity']);
```
![image](https://github.com/code7ssage/code7ssage.github.io/blob/master/assets/attached%20file/Pasted%20image%2020240114122502.png?raw=true)

```python
# â–¶ ìŒìˆ˜ ë°ì´í„° ê°’ í™•ì¸
# â–¶ Domain ì§€ì‹ì„ ë‹¤ì‹œ í•œ ë²ˆ ì ê²€í•´ì•¼í•¨ (â€» ë°˜í’ˆ ë° íšŒìˆ˜ ë¬¼ëŸ‰ì¼ ìˆ˜ ë„ ìˆìŒ)
df[df['Quantity']<0]
```
- í•­ìƒ ì œê±° ì „ì—ëŠ” í˜„ì—…ì˜ ì˜ê²¬ ì²´í¬ëŠ” í•´ì•¼í•¨

```python
# â–¶ Quantity ìŒìˆ˜ê°’ ì œê±°
df = df[df['Quantity']>0]
df.describe()
```
- dfë¥¼ quantity ì–‘ìˆ˜ì¸ ê²ƒìœ¼ë¡œ ì¬ì •ì˜

```python
# â–¶ ì¤‘ë³µ ë°ì´í„° í™•ì¸
pd.Series(df.duplicated()).value_counts()
```
- df.duplicated: ì¤‘ë³µì´ë©´ True

```python
# â–¶ ì¤‘ë³µ ë°ì´í„° í™•ì¸, raw data 
df[df.duplicated(keep=False)].sort_values(by=list(df.columns)).head(10)
```
- sort: ì •ë ¬
- keep= 'first', 'last', False
	- `keep='first'` (ê¸°ë³¸ê°’): ì²« ë²ˆì§¸ í–‰ì€ `False`ë¡œ, ë‚˜ë¨¸ì§€ ë‘ í–‰ì€ `True`ë¡œ í‘œì‹œë©ë‹ˆë‹¤. 
	- `keep='last'`: ë§ˆì§€ë§‰ í–‰ì€ `False`ë¡œ, ì²« ë²ˆì§¸ì™€ ë‘ ë²ˆì§¸ í–‰ì€ `True`ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
	- `keep=False`: ëª¨ë“  ì„¸ í–‰ì€ `True`ë¡œ í‘œì‹œë©ë‹ˆë‹¤.

```python
# â–¶ ì¤‘ë³µ ë°ì´í„° ì‚­ì œ í›„ ì¤‘ë³µ ì¬í™•ì¸
df = df.drop_duplicates(keep='first')
pd.Series(df.duplicated()).value_counts()
```
- ì²«ë²ˆì§¸ ë‚¨ê¸°ê³  drop

```python
# â–¶ ìµœì¢… Data í˜•íƒœ í™•ì¸ (541,909 â†’ 392,732)
df.shape
```
- 54ë§Œê°œ->39ë§Œê°œ
## **02. Data Readiness Check**
---
> **ë°ì´í„° ìˆ˜ì¤€ ì‚¬ì „ ì ê²€** 

* í˜„ì¬ ê°€ì§€ê³  ìˆëŠ” ë°ì´í„°ì˜ ìˆ˜ì¤€ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ”ì§€ ì ê²€
	(1) Target label ìƒì„±
	(2) Target Ratio í™•ì¸
	(3) ë¶„ì„ ë°©í–¥ì„± ê²°ì •

> **â‘  Target label ìƒì„±** 

* ë‹¹ì›” êµ¬ë§¤ ê³ ê°ì´ ë‹¤ìŒë‹¬ ì¬êµ¬ë§¤ ì‹œ í•´ë‹¹ ê³ ê°ì„ ì¬êµ¬ë§¤ ê³ ê°ìœ¼ë¡œ ì •ì˜ (â€» Target ì •ì˜)
	 ex) 2011.01ì›” êµ¬ë§¤ ê³ ê°ì´ ë‹¤ì‹œ 2011.2ì›”ì— êµ¬ë§¤ í•œ ê³ ê°ì€ ë¯¸ë˜ì— ì¬êµ¬ë§¤ ê³ ê°ì„

> **â‘¡ Target Ratio í™•ì¸** 

* 1ë²ˆ ë‹¨ê³„ì—ì„œ ìƒì„±í•œ Target Ratioì˜ ìˆ˜ì¤€ì„ í™•ì¸í•˜ê³ , ë¬¸ì œí•´ê²°ì´ ê°€ëŠ¥í•œ ìˆ˜ì¤€ì¸ì§€ íŒë‹¨

> **â‘¢ ë¶„ì„ ë°©í–¥ì„± ê²°ì •** 

* 1,2ë²ˆ ë‹¨ê³„ë¥¼ ì¢…í•©í•˜ì—¬ ë¶„ì„ ë°©í–¥ì„±ì„ ê²°ì •
	 ex) Target ratioê°€ ë‚®ë‹¤ë©´ ì „ì²´ê³ ê°ì´ ì•„ë‹Œ, íŠ¹ì • Segmentaion ê·¸ë£¹ìœ¼ë¡œ ì§„í–‰
	 ex) +1M êµ¬ë§¤ íƒ€ê²Ÿì€ +2M/+3Mê¹Œì§€ í™•ëŒ€í•˜ì—¬ Target Ratioë¥¼ ìƒìŠ¹

> ### **â”” Target label ìƒì„±** 

```python
df.head()
```

```python
from datetime import datetime

# â–¶ ê¸°ì¤€ë…„ì›” ì¶”ì¶œ (bsym)
df['date'] = df['InvoiceDate'].str.split(' ').str[0]
df['date'] = pd.to_datetime(df['date'])
df['bsym'] = df['date'].apply(lambda x: datetime.strftime(x, '%Y-%m'))

# â–¶ CustomerIDëŠ” str Typeìœ¼ë¡œ ë³€ê²½
df['CustomerID'] = df['CustomerID'].astype(str)
df.head()
```
- dateì—´ ì¶”ê°€: ê³µë°± ê¸°ì¤€ ë¶„ë¦¬í•´ì„œ ì›”/ì¼/ì—° ê°’ë§Œ ê°€ì§€ê³  ì˜¨ í›„ dateë¡œ ë°”ê¿”ì¤Œ
- bsymì—´ ì¶”ê°€: ê¸°ì¤€ë…„ì›” ì¶”ê°€í•´ì¤˜ì„œ ì›”ì˜ ì •ë³´ë“¤ì„ ë”°ë¡œ index í•´ì¤Œ
- C.IDëŠ” objectë¡œ ë°”ê¿ˆ

```python
# â–¶ ê¸°ì¤€ë…„ì›” ì¶”ê°€í•œ ì›ë³¸ ë°ì´í„° copy
df_origin = df.copy()
```

```python
# â–¶ ë°ì´í„° ì ì¬ ê¸°ê°„ í™•ì¸
df['date'].min(), df['date'].max()
```

```python
# â–¶ ê¸°ì¤€ë…„ì›” ê¸°ì¤€ìœ¼ë¡œ Uniqueí•œ CustomerID ì¶”ì¶œ
# â–¶ ë§¤ ì›” êµ¬ë§¤í•œ Uniqueí•œ ê³ ê°ì„ íŒŒì•…í•˜ê¸° ìœ„í•¨
df = df['bsym', 'CustomerID'](https://code7ssage.github.io/'bsym', 'CustomerID'//).drop_duplicates(keep='first')
df.head()
```
- ê³ ê°ì„ labelingí•˜ê¸° ìœ„í•´ ê³ ê°ID ì¤‘ë³µ ì œê±°

```python
# â–¶ Target label ìƒì„± Sample Code (1-loop)
i = '2011-01'

# â–¶ êµ¬í•˜ê³ ì í•˜ëŠ” ê¸°ì¤€ì›” ë°ì´í„° ì¶”ì¶œ
df_left = df[df['bsym'] == i]

# â–¶ ê¸°ì¤€ë…„ì›” +1m
bsym_1m = (pd.to_datetime(i) + pd.DateOffset(months=1)).strftime('%Y-%m')

# â–¶ ê¸°ì¤€ë…„ì›” +1m, CustomerIDëŠ” 1ì›”ì˜ êµ¬ë§¤í•œ ê³ ê°
df_right = pd.DataFrame(df[df['bsym'] == bsym_1m]['CustomerID'].unique())
df_right['target'] = 'Y'
df_right.columns = ['CustomerID', 'target']

# â–¶ ê¸°ì¤€ë…„ì›” Dataì— ê¸°ì¤€ë…„ì›” +1M ê³ ê°ì„ Joiní•˜ë©´ Target Data ìƒì„± ì™„ë£Œ
df_merge = pd.merge(df_left, df_right, how='left')
df_merge['target'] = df_merge['target'].fillna('N')
```
- 2011ë…„ 1ì›” ì •ë³´ë¥¼ dfì—ì„œ ê°–ê³  ì˜´-> left
- bsym_1m: 1ê°œì›”ì„ ë”í•´ì¤Œ
- ë¨¼ì €, df['bsym'] == bsym_1më¥¼ í†µí•´ dfì—ì„œ 'bsym' ì—´ì˜ ê°’ì´ bsym_1mê³¼ ì¼ì¹˜í•˜ëŠ” í–‰ì„ í•„í„°ë§
- unique: í•´ë‹¹ í–‰ë“¤ì˜ 'CustomerID' ì—´ì—ì„œ ê³ ìœ í•œ ê°’ë“¤ì„ ì¶”ì¶œ
- ì´ ê³ ìœ í•œ ê°’ë“¤ì˜ ë°°ì—´ë¡œ ìƒˆë¡œìš´ DataFrame df_rightë¥¼ ìƒì„± targerì— Yê°’ ë„£ì–´ì¤Œ
- mergeí•´ì£¼ê³  ë¹ˆ ê°’ì— Në„£ì–´ì¤Œ

```python
# â–¶ Target data ìƒì„± í™•ì¸
df_merge.head()
```

```python
df_merge['target'].value_counts()
```
- 1ì›”-> 2ì›”: í•œ 260ëª… ì •ë„ê°€ ì¬êµ¬ë§¤ í–ˆë‹¤ í™•ì¸

```python
# â–¶ forë¬¸ í™œìš© ì „ì²´ Data Set ëŒ€ìƒ Target label ìƒì„±
loop_list = list(df['bsym'].unique())
df_all = []

for i in loop_list :
  df_left = df[df['bsym'] == i]
  bsym_1m = (pd.to_datetime(i) + pd.DateOffset(months=1)).strftime('%Y-%m')
  df_right = pd.DataFrame(df[df['bsym'] == bsym_1m]['CustomerID'].unique())
  df_right['target'] = 1
  df_right.columns = ['CustomerID', 'target']
  df_merge = pd.merge(df_left, df_right, how='left')
  df_merge['target'] = df_merge['target'].fillna(0)

  df_all.append(df_merge)

df_all = pd.concat(df_all)
```
- loopë¡œ ëŒë ¤ì„œ ì „ì²´ ì›”ì— ì‹œí–‰

```python
df.shape, df_all.shape
```
- ë°ì´í„° ë³€ë™ì€ ì—†ëŠ”ì§€ í™•ì¸-> ì—´ 1ê°œë§Œ ëŠ˜ì—ˆìŒ

```python
df_all.head()
```

> ### **â”” Target ratio í™•ì¸**

```python
# â–¶ ê¸°ì¤€ë…„ì›”(bsym) ê¸°ì¤€ Target ratio í™•ì¸
df_target = df_all.groupby('bsym')['target'].agg(['sum', 'count']).reset_index()
df_target.columns = ['bsym', 'Y', 'Total']
df_target['ratio'] = df_target['Y']/df_target['Total']
df_target
```
- bsymê¸°ì¤€ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ê³  targetì—´ ì„ íƒ, ê° ê·¸ë£¹ì— ëŒ€í•´ í•©(sum), ê°œìˆ˜(count) ê³„ì‚°
- reset-> ë‹¤ì‹œ bsymì„ ì—´ë¡œ ëŒë ¤ë†“ìŒ
- ratio: Y(sum)/ total(count) 

```python
# â–¶ í˜„ì¬ ê°€ì§€ê³  ìˆëŠ” ë°ì´í„°ëŠ” 2011-12ì›”ì´ ë§ˆì§€ë§‰ì´ê¸° ë•Œë¬¸ì— ë‹¤ìŒë‹¬(2012-01) Target Dataë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŒ (â€» ë¶„ì„ ëŒ€ìƒì—ì„œ ì œì™¸)
df_target = df_target.iloc[0:12, :]
df_target
```
- 12ì›”ì€ ì œì™¸

```python
# â–¶ ì „ì²´ Data Setì— Target Ratio í™•ì¸
df_target['Y'].sum()/df_target['Total'].sum()
```
- ì „ì²´ ratio: 37%ì •ë„

```python
# â–¶ 12ì›” ë°ì´í„° ë¶„ì„ ëŒ€ìƒ ì œì™¸
df_all = df_all[df_all['bsym'] != '2011-12']
```

```python
# â–¶ ê²°ê³¼ì ìœ¼ë¡œ, ìš°ë¦¬ëŠ” Target Ratioê°€ ì•½ 37%ë˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ê³  í•˜ëŠ” ìƒí™©ì„
df_all['target'].sum()/len(df_all)
```

## **03. Data Sampling (1)**
---
> **Sampling ìˆ˜í–‰ ì—¬ë¶€ ê²°ì •** 

* Samplingì„ ì§„í–‰í•˜ë©´ íš¨ê³¼ì ìœ¼ë¡œ ë°ì´í„° ë¶„ì„ ë° ëª¨ë¸ë§ì„ ì§„í–‰í•  ìˆ˜ ìˆìŒ
	 - ë°ì´í„° Mart ìƒì„±ì‹œê°„ ë‹¨ì¶•
	 - ëª¨ë¸ í•™ìŠµ ì‹œê°„ ë‹¨ì¶•  
* í˜„ì¬ ë°ì´í„°ì˜ ìƒí™©ì— ë§ëŠ” Sampling ê¸°ë²•ì„ ì„ ì •í•˜ê³  Samplingì„ ìˆ˜í–‰

* Time series data
	  (1) up-sampling : ì£¼ê¸°ë¥¼ ë³€ê²½í•  ë•Œ, ê²°ì¸¡ê°’ ì±„ìš°ê¸°
	  (2) down-sampling : time window ê¸°ì¤€ mean(), max(), min()

* Non-time series data
	  (1) Target dataê°€ ë„ˆë¬´ ì ë‹¤ë©´(Class-Imbalanced) â†’ Over-sampling
	  (2) Dataê°€ ë„ˆë¬´ ë§ë‹¤ë©´ Under-sampling
	  â€» Under-samplingì‹œ **Stratified sampling**(ì¸µí™”ì¶”ì¶œ) ì§„í–‰

> **â‘  Over-sampling** 

* ëŒ€í‘œì  Over-sampling ê¸°ë²• [SMOTE](https://code7ssage.github.io/key_terms/SMOTE//)(Synthetic Minority Over-sampling Technique)
* ë‚®ì€ ë¹„ìœ¨ë¡œ ì¡´ì¬í•˜ëŠ” í´ë˜ìŠ¤ì˜ ë°ì´í„°ë¥¼ ìµœê·¼ì ‘ ì´ì›ƒ [KNN](https://code7ssage.github.io/key_terms/KNN//) ì•Œê³ ë¦¬ì¦˜ì„ í™œìš©í•˜ì—¬ ìƒˆë¡­ê²Œ ìƒì„±í•˜ëŠ” ë°©ë²•

> **â‘¡ Under-sampling & Stratified sampling (ì¸µí™”ì¶”ì¶œ)** 

* Stratified sampling(ì¸µí™”ì¶”ì¶œ) : ëª¨ì§‘ë‹¨ì„ ë™ì§ˆì ì¸ ì†Œì§‘ë‹¨ë“¤ë¡œ ì¸µí™”ì‹œí‚¤ê³  ê·¸ ì§‘ë‹¨ì˜ í¬ê¸°ì— ë”°ë¼ ë‹¨ìˆœë¬´ì‘ìœ„í‘œë³¸ì¶”ì¶œë°©ë²•
	- ë¹„ë¡€ì¸µí™”ì¶”ì¶œ : íŠ¹ì • ì¸µì˜ ëª¨ì§‘ë‹¨ì˜ ë¹„ìœ¨ê³¼ ë¹„ë¡€í•´ì„œ í‘œë³¸ì„ ì„ ì •í•˜ëŠ” ë°©ë²•

* ì¥ì 
	- ë‹¨ìˆœì„ì˜ ì¶”ì¶œë³´ë‹¤ ì‹ ë¢°ì„±ì´ ë†’ì€ ì¶”ì •ì¹˜ë¥¼ êµ¬í•  ìˆ˜ ìˆìŒ
	- ë¹„ìš© ì ˆê° ë° ìë£Œë¶„ì„ì´ ìš©ì´í•¨
	- ê° ì¸µì— ëŒ€í•œ ì¶”ì •ì¹˜ë¥¼ ë¶€ìˆ˜ì ìœ¼ë¡œ êµ¬í•  ìˆ˜ ìˆìŒ

* ë‹¨ì 
	- ë°©ëŒ€í•œ ëª¨ì§‘ë‹¨ì˜ ê²½ìš° ëª©ë¡ì‘ì„±ì˜ ì–´ë ¤ì›€
	- ì ì ˆí•˜ê²Œ ì¸µì„ ë‚˜ëˆ„ê¸° ìœ„í•´ì„œëŠ” ëª¨ì§‘ë‹¨ ê° ì¸µì— ëŒ€í•œ ì •í™•í•œ ì •ë³´ë¥¼ í•„ìš”
![image](https://github.com/code7ssage/code7ssage.github.io/blob/master/assets/attached%20file/Pasted%20image%2020240114125741.png?raw=true)

## **03. Data Sampling (2)**
---
> ### **â”” Time series : Up-sampling** 

```python
# â–¶ Time series Data ìƒì„±
time_index = pd.date_range('2023-01-01', periods=3, freq='10S')
df_time = pd.DataFrame({'value' : [1, 2, 3]}, index = time_index)
df_time
```

```python
# â–¶ Time series ì‹¤ìŠµ Up-sampling(5S)
df_upsample = df_time.resample('5S').mean()
df_upsample
```
- 10ì´ˆ ê°„ê²© ì´ì˜€ë˜ ë°ì´í„°ë¥¼ 5ì´ˆ ê°„ê²©ìœ¼ë¡œ ëŠ˜ë¦¼-> ê³µë°± ë°œìƒ

```python
# â–¶ ffill
df_upsample.fillna(method='ffill')

# â–¶ bfill
df_upsample.fillna(method='bfill')

# â–¶ fill(0)
df_upsample.fillna(0)

# â–¶ mean()
df_upsample.fillna(df_upsample.mean())

# â–¶ linear interpolation
df_upsample.interpolate()
```
- 1. ffill: ìœ„ì˜ í–‰ì˜ ê°’ ë„£ì–´ì¤Œ
- 2. bfill: ì•„ë˜ì˜ í–‰ì˜ ê°’ ë„£ì–´ì¤Œ
- 3. fill(0): 0 ë„£ì–´ì¤Œ
- 4. mean(): í‰ê· 
- 5. interpolate: ìœ„ ì•„ë˜ í–‰ì˜ ì‚¬ì´ê°’

> ### **â”” Time series : Down-sampling** 

```python
# â–¶ Down-sampling ì‹¤ìŠµ
df_upsample.resample('10S').mean()
```
- ì£¼ê¸°ë¥¼ 5->10ì´ˆë¡œ ëŠ˜ë¦¼, ë¹ˆ ê°’ì€ ë˜‘ê°™ì´ ì²˜ë¦¬

> ### **â”” Non-ts : SMOTE (Over-sampling)** 

```python
# â–¶ SMOTE ì‹¤ìŠµ
df_all.head()
```

```python
# â–¶ ì „ì²´ Data Setì— Target Ratio í™•ì¸
df_all['target'].sum()/len(df_all)
```

```python
df_all['target'].value_counts()
```

```python
# â–¶ Samplingì„ í•˜ê¸° ìœ„í•œ X, Y Data split
X = df_all.drop(['bsym', 'target'], axis=1)
Y = df_all['target']
```
- customer IDë§Œ ì‚¬ìš©
- X: C.ID, Y: target

```python
# â–¶ SMOTE í™œìš© Over-sampling
from imblearn.over_sampling import SMOTE

smote = SMOTE(random_state=42)
X_over, y_over = smote.fit_resample(X, Y)
print("SMOTE ì ìš© ì „ í•™ìŠµìš© í”¼ì²˜/ë ˆì´ë¸” ë°ì´í„° ì„¸íŠ¸ : ", X.shape, Y.shape)
print('SMOTE ì ìš© í›„ í•™ìŠµìš© í”¼ì²˜/ë ˆì´ë¸” ë°ì´í„° ì„¸íŠ¸ :', X_over.shape, y_over.shape)
print('SMOTE ì ìš© í›„ ê°’ì˜ ë¶„í¬ :\n',pd.Series(y_over).value_counts() )
```
- ì •ë‹µ(1)ì´ 4618->7822ë¡œ ì¦ê°€

```python
# â–¶ targetê³¼ non-target dataê°€ 5:5
pd.Series(y_over).value_counts(normalize=True) 
```
- ë¹„ìœ¨ì´ 1:1ë¡œ ê°™ì•„ì§
- normalize=True: ë¹„ìœ¨ë¡œ ë°”ê¿”ì¤Œ

> ### **â”” Non-ts : Stratified sampling** 

```python
# â–¶ Stratified sampling  ì‹¤ìŠµ
df_all.head()
```

```python
df_target
```

```python
# â–¶ ì¸µí™”ì¶”ì¶œì„ ìœ„í•´ ê° ì›” ë³„ ì°¨ì§€í•˜ëŠ” ë¹„ì¤‘ì„ ê³„ì‚° 
# â–¶ target_ratio / total_ratio col ìƒì„±
df_target['total_ratio'] = df_target['Total'] / df_target['Total'].sum()
df_target.columns = ['bsym', 'y', 'total_cnt', 'target_ratio', 'total_ratio']
df_target
```
- total ratio: ì „ì²´ì—ì„œ ì›”ì´ ì°¨ì§€í•˜ëŠ” ë¹„ì¤‘

```python
# â–¶ Total(sum)í–‰ ì¶”ê°€
df_target = df_target.append({'bsym': 'total'
          , 'y': df_target['y'].sum()
          , 'total_cnt': df_target['total_cnt'].sum()
          , 'target_ratio' : df_target['y'].sum() / df_target['total_cnt'].sum()
          , 'total_ratio' : 1}, ignore_index=True)
df_target
```
- ë§ˆì§€ë§‰ í–‰ì— ì „ì²´ sumí•´ì£¼ëŠ” ê±° ì¶”ê°€, total ratioëŠ” 1
- target ratioëŠ” í‰ê· ìœ¼ë¡œ

```python
# â–¶ ì „ì²´ Data setì—ì„œ 30% ë¹„ë¡€ ì¸µí™” ì¶”ì¶œ
len(df_all) * 0.3
```
- 3732ê°œì˜ ë°ì´í„°ë§Œ ê°€ì§€ê³  ì“¸êº¼

```python
# â–¶ 30% samplingì„ í•œë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ, ê° ì›” ë³„ ë¹„ì¤‘ê³¼ ë™ì¼í•˜ê²Œ Random sampling í•˜ëŠ” ê²ƒì´ ì¤‘ìš” (ë¹„ë¡€ì¸µí™”ì¶”ì¶œ)
# â–¶ sample_n : ë¹„ë¡€ì¸µí™”ì¶”ì¶œì„ ìœ„í•œ ì›” ë³„ ì¶”ì¶œ ê°œìˆ˜
df_target['sample_n_total'] = len(df_all) * 0.3
df_target['sample_n'] = df_target['sample_n_total'] * df_target['total_ratio']
df_target['sample_n'] = df_target['sample_n'].astype(int)
df_target
```
- ê° ì›”ë³„ë¡œ 30%ì”© ì¶”ì¶œí• êº¼

```python
# â–¶ ì›” ë³„ ë¹„ì¤‘ì„ ìœ ì§€í•˜ë©´ì„œ Random sampling ì§„í–‰
rnd_sate = 1234

df_all_00 = df_all[df_all['bsym'] == '2010-12'].sample(n=265, random_state = rnd_sate)
df_all_01 = df_all[df_all['bsym'] == '2011-01'].sample(n=222, random_state = rnd_sate)
df_all_02 = df_all[df_all['bsym'] == '2011-02'].sample(n=227, random_state = rnd_sate)
df_all_03 = df_all[df_all['bsym'] == '2011-03'].sample(n=292, random_state = rnd_sate)
df_all_04 = df_all[df_all['bsym'] == '2011-04'].sample(n=256, random_state = rnd_sate)
df_all_05 = df_all[df_all['bsym'] == '2011-05'].sample(n=316, random_state = rnd_sate)
df_all_06 = df_all[df_all['bsym'] == '2011-06'].sample(n=297, random_state = rnd_sate)
df_all_07 = df_all[df_all['bsym'] == '2011-07'].sample(n=284, random_state = rnd_sate)
df_all_08 = df_all[df_all['bsym'] == '2011-08'].sample(n=280, random_state = rnd_sate)
df_all_09 = df_all[df_all['bsym'] == '2011-09'].sample(n=379, random_state = rnd_sate)
df_all_10 = df_all[df_all['bsym'] == '2011-10'].sample(n=409, random_state = rnd_sate)
df_all_11 = df_all[df_all['bsym'] == '2011-11'].sample(n=499, random_state = rnd_sate)

df_all_sample = pd.concat([df_all_00, df_all_01, df_all_02, df_all_03, df_all_04, df_all_05, df_all_06, df_all_07, df_all_08, df_all_09, df_all_10, df_all_11], axis=0)
df_all_sample
```
- random stateê³ ì •, ê° ì›”ë³„ë¡œ ìƒ˜í”Œ ìˆ˜ê°€ ë‹¤ë¥´ë‹ˆ ê°ê° ì…ë ¥
- ë§ˆì§€ë§‰ì— concatí•´ì£¼ë©´ ëª¨ì•„ì„œ ë³¼ ìˆ˜ ìˆìŒ

```python
# â–¶ ì¸µí™”ì¶”ì¶œì´ ì •ìƒì ìœ¼ë¡œ ë˜ì—ˆëŠ”ì§€, ëª¨ìˆ˜ì˜ target ratioì™€ ë¹„êµ
df_all_sample_temp = df_all_sample.groupby(['bsym'])['target'].agg(['sum', 'count']).reset_index()
df_all_sample_temp['target_ratio'] = df_all_sample_temp['sum'] / df_all_sample_temp['count']
df_all_sample_temp['target_ratio_mosu'] = df_target['target_ratio']

df_all_sample_temp.style.bar(subset=['target_ratio','target_ratio_mosu'], align='zero', vmin=0, vmax=0.8)
```
- df sampleì—ì„œ target ratio ê³„ì‚°í•´ì„œ ëª¨ìˆ˜ì˜ ratioì™€ ë¹„êµ
- bar í˜•íƒœë¡œ ì‹œê°í™” í•´ì„œ ì—‘ì…€ì²˜ëŸ¼ í‘œí˜„ë„ ê°€ëŠ¥

![image](https://github.com/code7ssage/code7ssage.github.io/blob/master/assets/attached%20file/Pasted%20image%2020240114130411.png?raw=true)

```python
# â–¶ sample ì „ì²´ Target ratio (â€» mosu 37%)
df_all_sample_temp['sum'].sum() / df_all_sample_temp['count'].sum()
```
- ìƒ˜í”Œì˜ target ratioëŠ” 38%ë¡œ ã„±ã…Šì€ë“¯
- ê·¼ë° ë” ì°¨ì´ë¥¼ ì¤„ì´ê³  ì‹¶ìœ¼ë©´ random stateë¥¼ ë°”ê¿”ê°€ë©° ì¡°ì ˆ ê°€ëŠ¥

```python
df_all_sample.shape 
```

