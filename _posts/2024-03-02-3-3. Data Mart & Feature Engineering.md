---
title: 3 3. Data Mart & Feature Engineering
categories:
  - machine_learning
toc: true
---

# **ğŸš© Chapter 03**  

---
> **ëª©ì°¨(Context)**

* 01.Data Mart ê¸°íš ë° ì„¤ê³„
* 02.Data ì¶”ì¶œ ë° Mart  ê°œë°œ
* 03.Integer Feature Engineering
* 04.Categoical Feature Engineering

## **01. Data Mart ê¸°íš ë° ì„¤ê³„**
---
> **ëª¨ë¸ë§ì„ ìœ„í•œ Data Mart ê¸°íš** 

![image](https://github.com/code7ssage/code7ssage.github.io/blob/master/assets/attached%20file/Pasted%20image%2020240114130539.png?raw=true)

* Sampling ì™„ë£Œ í›„ ì›” ë³„ ê¸°ì¤€ì´ ë˜ëŠ” CustomerIDë¥¼ ì¶”ì¶œí•œ ìƒíƒœ
* Martë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•œ ì¤€ë¹„ê°€ ëª¨ë‘ ì™„ë£Œëœ ìƒíƒœ
* **ê°€ì„¤**ì„ ìˆ˜ë¦½í•˜ê³ , ê°€ì„¤ì— í•´ë‹¹í•˜ëŠ” ë‹¤ì–‘í•œ ë³€ìˆ˜ Categoryì™€ Listë¥¼ ìƒì„±
* í’ë¶€í•œ Data Martë¥¼ ê¸°íší•´ì•¼ ì¢‹ì€ ëª¨ë¸ì˜ ì„±ëŠ¥ê³¼ ë‹¤ì–‘í•œ í•´ì„ì´ ê°€ëŠ¥

![image](https://github.com/code7ssage/code7ssage.github.io/blob/master/assets/attached%20file/Pasted%20image%2020240114130549.png?raw=true)

## **02. Data ì¶”ì¶œ ë° Mart  ê°œë°œ**
---
> **Data Mart ê¸°íšì„œ ë°ì´í„° ì¶”ì¶œ** 

* ìƒìœ„ ë‹¨ê³„ì—ì„œ ì •ì˜í•œ Data Martë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë³€ìˆ˜ë¥¼ ì¶”ì¶œí•˜ëŠ” ê³¼ì •
* ë³€ìˆ˜ ì¶”ì¶œì€ Samplingí•œ Dataë¡œ ì§„í–‰

```python
# â–¶ ìµœì´ˆ Dataì—ì„œ bsym(ê¸°ì¤€ë…„ì›”)ì„ ì¶”ê°€í•œ origin data
df_origin.head()
```
- ì•„ê¹Œ ë³µì‚¬ í•´ë†¨ë˜ ì›ë³¸ì— bsymë¶™ì¸ê±°

> ### **â”” Mart ê°œë°œ ì¤€ë¹„** 

```python
# â–¶ Samplingí•œ CustomerID ëŒ€ìƒ Mart ê°œë°œ ìˆ˜í–‰
df_all_sample.head()
```
- ìƒ˜í”Œë§ í•œê²Œ ë§ëŠ”ì§€ í™•ì¸? .shape

```python
# â–¶ ì›ë³¸(Origin) dataì—ì„œ Sampling í•˜ê¸° ìœ„í•œ key ìƒì„± (1)
df_origin['sample_key'] = df_origin['bsym'].astype(str) + df_origin['CustomerID'].astype(str)
df_origin.head()
```
- ì›ë³¸ì— í‚¤ í˜•ì„±

```python
# â–¶ ì›ë³¸(Origin)ì—ì„œ Sampling í•˜ê¸° ìœ„í•œ key ìƒì„± (2)
df_all_sample['sample_key'] = df_all_sample['bsym'].astype(str) + df_all_sample['CustomerID'].astype(str)
df_all_sample.head()
```
- ìƒ˜í”Œë§í•œ ë°ì´í„°ì—ë„ í‚¤ í˜•ì„±

```python
# â–¶ sampling ëœ CustomerIDë§Œ ì¶”ì¶œ 
df_origin_sample = df_origin[df_origin['sample_key'].isin(df_all_sample['sample_key'])]

# â–¶ amt col ìƒì„±
df_origin_sample['amt'] = df_origin_sample['UnitPrice'] * df_origin_sample['Quantity']
df_origin_sample.head()
```
- isin: ì›ë³¸ì—ì„œ ìƒ˜í”Œì— ìˆëŠ” í‚¤ë§Œ ê°€ì§€ê³  ì˜´
- amt: ì–‘ X ë‹¨ìœ„ ê°€ê²©

```python
df_origin.shape, df_origin_sample.shape
```
- 39ë§Œ->11ë§Œ

> ### **â”” Mart ì¶”ì¶œ ì‹œì‘** 

```python
# â–¶ ë³€ìˆ˜ ìƒì„± ì‹œì‘ (total_amt)
df_mart = df_origin_sample.groupby(['bsym', 'CustomerID'])['amt'].agg(total_amt = ('sum')).reset_index()
df_mart
```
- total_amt = ('sum'): sum í•´ì¤€ ë’¤, total_amtë¡œ ì—´ ë§Œë“¤ì–´ì¤Œ ìœ ìš©
- reset_indexëŠ” ì¨ì£¼ëŠ”ê²Œ ìœ ìš©

```python
# â–¶ ë³€ìˆ˜ ìƒì„± ì‹œì‘ (max_amt, min_amt)
# pd.DataFrame(df_origin_sample.groupby(['bsym', 'CustomerID', 'InvoiceNo'])['amt'].agg(amt = ('sum')).reset_index()).groupby(['bsym', 'CustomerID'])['amt'].agg(max_amt = ('max')).reset_index()
df_mart['max_amt', 'min_amt'](https://code7ssage.github.io/'max_amt', 'min_amt'//) = pd.DataFrame(df_origin_sample.groupby(['bsym', 'CustomerID', 'InvoiceNo'])['amt'].agg(amt = ('sum')).reset_index()).groupby(['bsym', 'CustomerID'])['amt'].agg(max_amt = ('max'), min_amt = ('min')).reset_index()['max_amt', 'min_amt'](https://code7ssage.github.io/'max_amt', 'min_amt'//)
df_mart
```
- bsym, customer ID, invoiceNo ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹í™” -> amt=sum -> reset
- sym, customer ID ê·¸ë£¹í™” -> max, min -> reset ->max, minë§Œ ê°€ì ¸ì˜´(ëŒ€ê´„í˜¸ 2ê°œ)

```python
# â–¶ ë³€ìˆ˜ ìƒì„± ì‹œì‘ (total_cnt)
df_mart['total_cnt'] = pd.DataFrame(df_origin_sample.groupby(['bsym', 'CustomerID'])['InvoiceNo'].agg(total_cnt = ('nunique'))).reset_index()['total_cnt']
df_mart
```
- nunique: uniqueí•œ ì• ë“¤ë§Œ ì¹´ìš´íŠ¸

```python
# â–¶ ë³€ìˆ˜ ìƒì„± ì‹œì‘ (max_cnt, min_cnt)
df_mart['max_cnt', 'min_cnt'](https://code7ssage.github.io/'max_cnt', 'min_cnt'//) = pd.DataFrame(df_origin_sample.groupby(['bsym', 'CustomerID', 'InvoiceNo'])['StockCode'].agg(stock_cnt = 'nunique').reset_index()).groupby(['bsym', 'CustomerID'])['stock_cnt'].agg(max_cnt = ('max'), min_cnt = ('min')).reset_index()['max_cnt', 'min_cnt'](https://code7ssage.github.io/'max_cnt', 'min_cnt'//)
df_mart
```

```python
# â–¶ ë³€ìˆ˜ ìƒì„± ì‹œì‘ (total_qty, max_qty, min_qty)
df_mart['total_qty', 'max_qty', 'min_qty'](https://code7ssage.github.io/'total_qty', 'max_qty', 'min_qty'//) = df_origin_sample.groupby(['bsym', 'CustomerID'])['Quantity'].agg(total_qty = 'sum', max_qty = 'max', min_qty = 'min').reset_index()['total_qty', 'max_qty', 'min_qty'](https://code7ssage.github.io/'total_qty', 'max_qty', 'min_qty'//)
df_mart
```

```python
# â–¶ ë³€ìˆ˜ ìƒì„± ì‹œì‘ (country)
df_mart['Country'] = df_origin_sample.groupby(['bsym', 'CustomerID'])['Country'].agg(country = 'first').reset_index()['country']
df_mart
```

```python
# â–¶ target join
df_mart = pd.merge(df_mart, df_all_sample['bsym', 'CustomerID', 'target'](https://code7ssage.github.io/'bsym', 'CustomerID', 'target'//), how='left', on=['bsym', 'CustomerID'])
df_mart
```
- target ë°ì´í„°ê°€ ì—†ìœ¼ë‹ˆ all sampleì—ì„œ ê°€ì ¸ì˜´, ê¸°ì¤€: bsym, customer ID

```python
# â–¶ ìµœì¢… Data set
df_mart.shape
```

## **03. Integer Feature Engineering**
---
> **Feature Engineeringì´ë€?** 

* ëª¨ë¸ë§ì˜ ëª©ì ì¸ ì„±ëŠ¥í–¥ìƒì„ ìœ„í•´ Featureë¥¼ ìƒì„±, ì„ íƒ, ê°€ê³µí•˜ëŠ” ì¼ë ¨ì˜ ëª¨ë“  í™œë™

> **Target ë³€ìˆ˜ì™€ì˜ ì˜ë¯¸ìˆëŠ” ë³€ìˆ˜ ì„ íƒí•˜ëŠ” ë°©ë²•** 

* [Regression](https://code7ssage.github.io/key_terms/regression//)(íšŒê·€) : ìƒê´€ê³„ìˆ˜ ë¶„ì„ì„ í†µí•´ ìœ ì˜ë¯¸í•œ ë³€ìˆ˜ ì„ íƒ 
* [Classification](https://code7ssage.github.io/key_terms/classification//)(ë¶„ë¥˜) : bin(í†µ)ìœ¼ë¡œ êµ¬ë¶„ í›„ Target ë³€ìˆ˜ì™€ì˜ ê´€ê³„ íŒŒì•…

> **IV (Information Value)**

* Feature í•˜ë‚˜ê°€ Good(Target)ê³¼ Bad(Non-target)ì„ ì˜ êµ¬ë¶„í•´ì¤„ ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•œ ì •ë³´ëŸ‰ì„ í‘œí˜„í•˜ëŠ” ë°©ë²•ë¡ 
* IV ìˆ˜ì¹˜ê°€ í´ìˆ˜ë¡ Targetê³¼ Non-targetì„ ì˜ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ” ì •ë³´ëŸ‰ì´ ë§ì€ Featureì´ê³ , IV ìˆ˜ì¹˜ê°€ ì‘ì„ìˆ˜ë¡ ì •ë³´ëŸ‰ì´ ì ì€ Feature
* (Target data êµ¬ì„±ë¹„ - Non-target data êµ¬ì„±ë¹„) * WoE
* WoE(Weight of Evidence) = ln(Target data êµ¬ì„±ë¹„ / Non-target data êµ¬ì„±ë¹„)
* ln(ìì—°ë¡œê·¸)ë¥¼ ì·¨í•˜ëŠ” ì´ìœ ? : WoEì˜ ìµœëŒ€, ìµœì†Œê°’ì˜ ë²”ìœ„ë¥¼ ë§ì¶°ì£¼ê¸° ìœ„í•´ (1~âˆ , -âˆ~1)

 [ê°œë… ì°¸ì¡°](https://zzinnam.tistory.com/entry/Information-Value-%EC%82%B0%EC%B6%9C%ED%95%98%EA%B8%B0)

> ### **â”” Regression ë¬¸ì œ (corr)** 

```python
df_mart.head()
```

```python
# â–¶ heatmap plot
import seaborn as sns
# â–¶ ëª¨ë“  ì¡°í•©, ìƒê´€ê³„ìˆ˜ í‘œí˜„

df_pair = df_mart['total_amt', 'max_amt', 'min_amt', 'total_cnt','max_cnt', 'min_cnt', 'total_qty', 'max_qty', 'min_qty'](https://code7ssage.github.io/'total_amt', 'max_amt', 'min_amt', 'total_cnt','max_cnt', 'min_cnt', 'total_qty', 'max_qty', 'min_qty'//)
mask = np.triu(np.ones_like(df_pair.corr(), dtype=np.bool))
sns.heatmap(df_pair.corr(), vmin = -1, vmax = +1, annot = True, cmap = 'coolwarm', mask = mask);
plt.gcf().set_size_inches(10, 10)
```
- mask: heatmapì—ì„œ ì¤‘ë³µë˜ëŠ” ëŒ€ì¹­ì¸ ë¶€ë¶„ ê°€ë ¤ì£¼ëŠ”ê±° 

![image](https://github.com/code7ssage/code7ssage.github.io/blob/master/assets/attached%20file/Pasted%20image%2020240114131030.png?raw=true)

> ### **â”” Classification ë¬¸ì œ (IV)** 

```python
# â–¶ Binning
total_amt_quantile  = df_mart['total_amt'].quantile(q=list(np.arange(0.05,1,0.05)), interpolation = 'nearest')
# total_amt_quantile

# â–¶ ê·¸ë£¹ ì´ˆê¸°í™” 
df_mart['total_amt_grp'] = 0

# â–¶ 40%, 75% ê¸°ì¤€ìœ¼ë¡œ ì´ 3ê°œ êµ¬ê°„í™” ì§„í–‰ 
for i in  range(len(df_mart['total_amt'])) :
  if df_mart.loc[i, "total_amt"] <= total_amt_quantile.iloc[7] : # 40%
    df_mart.loc[i, 'total_amt_grp'] = 1
  elif df_mart.loc[i, "total_amt"] <= total_amt_quantile.iloc[14] : # 75%
    df_mart.loc[i, 'total_amt_grp'] = 2
  else : df_mart.loc[i, 'total_amt_grp'] = 3
```
- quantile: 5%ì”© ì˜ë¼ì„œ ë°ì´í„° ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ì–´ì¤Œ
- interpolation = 'nearest': í•´ë‹¹ %ì— ë°ì´í„°ê°€ ì—†ì„ ë•Œ ê°€ì¥ ê·¼ì ‘í•œ ë°ì´í„° ë„£ì–´ì¤Œ
- [0]ì¼ë•Œê°€ 5%ë‹ˆê¹Œ, [7]ì¼ ë•Œ 40%, [14]ì¼ ë•Œ 75%

```python
df_mart.groupby('total_amt_grp')['target'].agg(['sum', 'count'])
```

```python
# â–¶ non-target labeling
df_mart['n_target'] = np.where(df_mart['target']==0, 1, 0)

# â–¶ target , non-target count
iv = df_mart.groupby('total_amt_grp')['target', 'n_target'](https://code7ssage.github.io/'target', 'n_target'//).sum().reset_index()

# â–¶ good_pct / bad_pct ê³„ì‚°
iv['good_pct'] = iv['target'] / iv['target'].sum()
iv['bad_pct'] = iv['n_target'] / iv['n_target'].sum()

# â–¶ t_ratio
iv['t_ratio'] = iv['target'] / (iv['target'] + iv['n_target'])

iv
```
- n_target: targetì´ 0ì´ë©´ 1ì„ ë„£ì–´ì£¼ê³  ì•„ë‹ˆë©´ 0ì„ ë„£ì–´ì¤Œ
- good, bad, t í¼ì„¼íŠ¸ ê°ê° ê³„ì‚°

```python
# â–¶ Groupë³„ IV ê³„ì‚°
import math

for i in range(len(iv['total_amt_grp'])) :
  iv.loc[i, 'iv'] = (iv.loc[i,'good_pct'] - iv.loc[i,'bad_pct']) * math.log(iv.loc[i,'good_pct']/iv.loc[i,'bad_pct'])

iv
```
- IV ê³„ì‚°í•˜ë©´ 1loop ì¢…ë£Œ

```python
# forë¬¸ í™œìš© ìë™í™”
integer_list = ['total_amt', 'max_amt', 'min_amt', 'total_cnt','max_cnt', 'min_cnt', 'total_qty', 'max_qty', 'min_qty']
iv_df = []

for val in integer_list : 
    # â–¶ Binning
    quantile  = df_mart[val].quantile(q=list(np.arange(0.05,1,0.05)), interpolation = 'nearest')

    # â–¶ ê·¸ë£¹ ì´ˆê¸°í™” 
    df_mart['grp'] = 0

    # â–¶ 40%, 75% ê¸°ì¤€ìœ¼ë¡œ ì´ 3ê°œ êµ¬ê°„í™” ì§„í–‰ 
    for i in  range(len(df_mart[val])) :
      if df_mart.loc[i, val] <= quantile.iloc[7] :
        df_mart.loc[i, 'grp'] = 1
      elif df_mart.loc[i, val] <= quantile.iloc[14] :
        df_mart.loc[i, 'grp'] = 2
      else : df_mart.loc[i, 'grp'] = 3

    # â–¶ non target labeling
    df_mart['n_target'] = np.where(df_mart['target']==0, 1, 0)

    # â–¶ target , non-target count
    iv = df_mart.groupby('grp')['target', 'n_target'](https://code7ssage.github.io/'target', 'n_target'//).sum().reset_index()

    # â–¶ good_pct / bad_pct ê³„ì‚°
    iv['good_pct'] = iv['target'] / iv['target'].sum()
    iv['bad_pct'] = iv['n_target'] / iv['n_target'].sum()

    # â–¶ t_ratio
    iv['t_ratio'] = iv['target'] / (iv['target'] + iv['n_target'])

    iv['val'] = val

    for i in range(len(iv['grp'])) :
      iv.loc[i, 'iv'] = (iv.loc[i,'good_pct'] - iv.loc[i,'bad_pct']) * math.log(iv.loc[i,'good_pct']/iv.loc[i,'bad_pct'])
  
    iv_df.append(iv)

iv_df=pd.concat(iv_df)
iv_df
```
- total_amt ~min_qty ê¹Œì§€ 1,2,3 binì— ëŒ€í•´ IVê°’ ê³„ì‚°

```python
# â–¶ Featureë³„ ì „ì²´ IV ê°’ì„ sumí•´ì„œ ë¹„êµ
iv_df.groupby('val')['iv'].sum().sort_values(ascending=False)
```
- featureë³„ IVê°’ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë¦¬

## **04. Categoical Feature Engineering**
---
> **Feature Engineeringì´ë€?** 

* ëª¨ë¸ë§ì˜ ëª©ì ì¸ ì„±ëŠ¥í–¥ìƒì„ ìœ„í•´ Featureë¥¼ ìƒì„±, ì„ íƒ, ê°€ê³µí•˜ëŠ” ì¼ë ¨ì˜ ëª¨ë“  í™œë™

> **Target ë³€ìˆ˜ì™€ì˜ ì˜ë¯¸ìˆëŠ” ë³€ìˆ˜ ì„ íƒí•˜ëŠ” ë°©ë²•** 

* ì°¨ì›ì´ ë„ˆë¬´ ë§ì€ ê²½ìš°ì—ëŠ” ì°¨ì›ì„ Domain ì§€ì‹ì„ í™œìš©í•˜ì—¬ ì¶•ì†Œí•  ê²ƒ 

> **IV (Information Value)**

* Feature í•˜ë‚˜ê°€ Good(Target)ê³¼ Bad(Non-target)ì„ ì˜ êµ¬ë¶„í•´ì¤„ ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•œ ì •ë³´ëŸ‰ì„ í‘œí˜„í•˜ëŠ” ë°©ë²•ë¡ 
* IV ìˆ˜ì¹˜ê°€ í´ìˆ˜ë¡ Targetê³¼ Non-targetì„ ì˜ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ” ì •ë³´ëŸ‰ì´ ë§ì€ Featureì´ê³ , IV ìˆ˜ì¹˜ê°€ ì‘ì„ìˆ˜ë¡ ì •ë³´ëŸ‰ì´ ì ì€ Feature
* (Target data êµ¬ì„±ë¹„ - Non-target data êµ¬ì„±ë¹„) * WoE
* WoE(Weight of Evidence) = ln(Target data êµ¬ì„±ë¹„ / Non-target data êµ¬ì„±ë¹„)
* ln(ìì—°ë¡œê·¸)ë¥¼ ì·¨í•˜ëŠ” ì´ìœ ? : WoEì˜ ìµœëŒ€, ìµœì†Œê°’ì˜ ë²”ìœ„ë¥¼ ë§ì¶°ì£¼ê¸° ìœ„í•´ (1~âˆ , -âˆ~1)

[ê°œë… ì°¸ì¡°](https://zzinnam.tistory.com/entry/Information-Value-%EC%82%B0%EC%B6%9C%ED%95%98%EA%B8%B0)

> **Catplot**

* Categorical Plot : ìƒ‰ìƒ(hue)ê³¼ í–‰(row)ë“±ì„ ë™ì‹œì— ì‚¬ìš©í•˜ì—¬ 3 ê°œ ì´ìƒì˜ ì¹´í…Œê³ ë¦¬ ê°’ì— ì˜í•œ ë³€í™”ë¥¼ ê·¸ë ¤ë³¼ ìˆ˜ ìˆìŒ 
* Categorical dataë¥¼ íŒŒì•…í•˜ëŠ”ë° ìš©ì´í•¨

```python
df_mart.head()
```

```python
import seaborn as sns
import matplotlib.pyplot as plt
%matplotlib inline
plt.style.use(['dark_background'])

# â–¶ target ê¸°ì¤€(hue,ìƒ‰ìƒ)ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ Plot
sns.catplot(x="Country", hue="target", kind="count",palette="pastel", edgecolor=".6",data=df_mart);
plt.xticks(rotation=-20)

plt.gcf().set_size_inches(25, 3)
```
- hue: íŒŒë‘: 0, ì£¼í™©: 1

![image](https://github.com/code7ssage/code7ssage.github.io/blob/master/assets/attached%20file/Pasted%20image%2020240114131245.png?raw=true)

```python
# â–¶ EDA value
df_cat = pd.DataFrame(df_mart['Country'].value_counts())
df_cat['ratio'] = df_cat['Country'] / df_cat['Country'].sum()
df_cat
```
- UK: 90% ì°¨ì§€ -> ë‚˜ë¨¸ì§€ëŠ” ë¬¶ì–´ë„ ìƒê´€ ì—†ì„ ë“¯?

```python
# â–¶ UK(ì˜êµ­) ì´ì™¸ëŠ” ê¸°íƒ€êµ­ê°€ë¡œ ì²˜ë¦¬
df_mart['Country'] = np.where(df_mart['Country'] == 'United Kingdom', 'UK', 'ETC')
df_mart['Country'].value_counts()
```
- np.where == (if, true, false)

```python
# â–¶ target , non-target count
iv = df_mart.groupby('Country')['target', 'n_target'](https://code7ssage.github.io/'target', 'n_target'//).sum().reset_index()

# â–¶ good_pct /bad_pct ê³„ì‚°
iv['good_pct'] = iv['target'] / iv['target'].sum()
iv['bad_pct'] = iv['n_target'] / iv['n_target'].sum()

# â–¶ t_ratio
iv['t_ratio'] = iv['target'] / (iv['target'] + iv['n_target'])

iv['val'] = 'Country'

for i in range(len(iv['Country'])) :
  iv.loc[i, 'iv'] = (iv.loc[i,'good_pct'] - iv.loc[i,'bad_pct']) * math.log(iv.loc[i,'good_pct']/iv.loc[i,'bad_pct'])

iv
```

```python
# â–¶ ë§ì€ ì •ë³´ëŸ‰ì„ ê°€ì§€ê³  ìˆì§€ ì•ŠìŒ
iv['iv'].sum()
```
- 0.000017.. -> ë„ˆë¬´ ë‚®ìŒ;

```python
# â–¶ ìµœì¢… Mart ì €ì¥
df_mart = pd.DataFrame(df_mart)
df_mart.to_csv('df_mart.csv', index=False)
```
- ë§ˆíŠ¸ ì €ì¥ í•„ìˆ˜!

â–¶ OptimalBinning

```python
!pip install optbinning
```

```python
# â–¶ numeric
# !pip install optbinning
from optbinning import OptimalBinning

integer_list = ['total_amt', 'max_amt', 'min_amt', 'total_cnt','max_cnt', 'min_cnt', 'total_qty', 'max_qty', 'min_qty']
iv_df = []

for i in integer_list :
  variable = i
  x = df_mart[variable].values
  y = df_mart.target
  # max_n_prebins
  optb = OptimalBinning(name=variable, dtype="numerical", solver="cp", max_n_prebins=3)
  optb.fit(x, y)
  # print("split points : ", optb.splits)

  binning_table = optb.binning_table
  v1 = binning_table.build()

  df = pd.DataFrame({'val' : variable,
                     'IV' : [v1.loc['Totals','IV']]})
  iv_df.append(df)

iv_df = pd.concat(iv_df).reset_index(drop=True)
iv_df.sort_values(by=['IV'], ascending = False)


# binning_table.plot(metric="event_rate")
```
- x: ì—´ì˜ ë°ì´í„° ê°’, y: target
- numerical ì¼ë•ŒëŠ” cpê°€ ë””í´íŠ¸ 
- max_n_prebins: ëª‡ê°œì˜ bin ë§Œë“¤ê±´ì§€
- val, IVê°€ í‚¤ ì¸ dictí˜•íƒœë¡œ ë°ì´í„° í”„ë ˆì„ í˜•ì„±

```python
binning_table.plot(metric="event_rate")
```
- event rateê°€ íƒ€ê²Ÿë¥ 
- ì•„ê¹Œë‘ bining ê¸°ì¤€ì´ ë‹¬ë¼ì ¸ IVê°’ì€ ë‹¬ë¼ì§ ì£¼ì˜
![image](https://github.com/code7ssage/code7ssage.github.io/blob/master/assets/attached%20file/Pasted%20image%2020240114131723.png?raw=true)

```python
# â–¶ Categorical
variable_cat = "Country"
x_cat = df_mart[variable_cat].values
y_cat = df_mart.target

optb = OptimalBinning(name=variable_cat, dtype="categorical", solver="mip",
                      cat_cutoff=0.1)

optb.fit(x_cat, y_cat)
optb.splits

binning_table = optb.binning_table
display(binning_table.build())

binning_table.plot(metric="event_rate")
```
- categoricalì—ì„œëŠ” mipì‚¬ìš©
- cat_cutoff=0.1: 10%ë¯¸ë§Œì˜ ê²ƒì€ ìë™ì ìœ¼ë¡œ etcë¡œ ë¬¶ì–´ì¤Œ
![image](https://github.com/code7ssage/code7ssage.github.io/blob/master/assets/attached%20file/Pasted%20image%2020240114131837.png?raw=true)